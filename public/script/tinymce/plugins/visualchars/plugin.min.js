(function(){"use strict";var K=tinymce.util.Tools.resolve("tinymce.PluginManager");const A=t=>e=>typeof e===t,k=t=>(e=>{const n=typeof e;return e===null?"null":n==="object"&&Array.isArray(e)?"array":n==="object"&&(s=o=e,(r=String).prototype.isPrototypeOf(s)||((a=o.constructor)===null||a===void 0?void 0:a.name)===r.name)?"string":n;var s,o,r,a})(t)==="string",N=t=>t===null,R=A("boolean"),U=A("number");class l{constructor(e,n){this.tag=e,this.value=n}static some(e){return new l(!0,e)}static none(){return l.singletonNone}fold(e,n){return this.tag?n(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?l.some(e(this.value)):l.none()}bind(e){return this.tag?e(this.value):l.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:l.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e!=null?e:"Called getOrDie on None")}static from(e){return e==null?l.none():l.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}l.singletonNone=new l(!1);const f=(t,e)=>{for(let n=0,s=t.length;n<s;n++)e(t[n],n)},$=Object.keys,C=(t,e)=>{const n=$(t);for(let s=0,o=n.length;s<o;s++){const r=n[s];e(t[r],r)}};typeof window!="undefined"||Function("return this;")();const T=t=>t.dom.nodeValue,q=t=>(e=>e.dom.nodeType)(t)===3,O=(t,e,n)=>{((s,o,r)=>{if(!(k(r)||R(r)||U(r)))throw console.error("Invalid call to Attribute.set. Key ",o,":: Value ",r,":: Element ",s),new Error("Attribute value was not simple");s.setAttribute(o,r+"")})(t.dom,e,n)},B=(t,e)=>{t.dom.removeAttribute(e)},y=(t,e)=>{const n=((s,o)=>{const r=s.dom.getAttribute(o);return r===null?void 0:r})(t,e);return n===void 0||n===""?[]:n.split(" ")},b=t=>t.dom.classList!==void 0,z=t=>{if(t==null)throw new Error("Node cannot be null or undefined");return{dom:t}},m=z,v={"\xA0":"nbsp","\xAD":"shy"},S=(t,e)=>{let n="";return C(t,(s,o)=>{n+=o}),new RegExp("["+n+"]",e?"g":"")},G=S(v),H=S(v,!0),J=(t=>{let e="";return C(t,n=>{e&&(e+=","),e+="span.mce-"+n}),e})(v),V="mce-nbsp",Q=t=>'<span data-mce-bogus="1" class="mce-'+v[t]+'">'+t+"</span>",W=t=>{const e=T(t);return q(t)&&k(e)&&G.test(e)},x=(t,e)=>{let n=[];const s=((o,r)=>{const a=o.length,u=new Array(a);for(let i=0;i<a;i++){const c=o[i];u[i]=r(c,i)}return u})(t.dom.childNodes,m);return f(s,o=>{e(o)&&(n=n.concat([o])),n=n.concat(x(o,e))}),n},E=t=>t.nodeName.toLowerCase()==="span"&&t.classList.contains("mce-nbsp-wrap"),L=(t,e)=>{const n=t.dom,s=x(m(e),W);f(s,o=>{var r;const a=o.dom.parentNode;if(E(a))u=m(a),i=V,b(u)?u.dom.classList.add(i):((c,h)=>{((d,g,P)=>{const p=y(d,g).concat([P]);O(d,g,p.join(" "))})(c,"class",h)})(u,i);else{const c=n.encode((r=T(o))!==null&&r!==void 0?r:"").replace(H,Q),h=n.create("div",{},c);let d;for(;d=h.lastChild;)n.insertAfter(d,o.dom);t.dom.remove(o.dom)}var u,i})},j=(t,e)=>{const n=t.dom.select(J,e);f(n,s=>{var o,r;E(s)?(o=m(s),r=V,b(o)?o.dom.classList.remove(r):((a,u)=>{((i,c,h)=>{const d=((g,P)=>{const p=[];for(let w=0,Z=g.length;w<Z;w++){const F=g[w];F!==h&&p.push(F)}return p})(y(i,c));d.length>0?O(i,c,d.join(" ")):B(i,c)})(a,"class",u)})(o,r),(a=>{(b(a)?a.dom.classList:(i=>y(i,"class"))(a)).length===0&&B(a,"class")})(o)):t.dom.remove(s,!0)})},D=t=>{const e=t.getBody(),n=t.selection.getBookmark();let s=((o,r)=>{for(;o.parentNode;){if(o.parentNode===r)return r;o=o.parentNode}})(t.selection.getNode(),e);s=s!==void 0?s:e,j(t,s),L(t,s),t.selection.moveToBookmark(n)},I=(t,e)=>{((s,o)=>{s.dispatch("VisualChars",{state:o})})(t,e.get());const n=t.getBody();e.get()===!0?L(t,n):j(t,n)},X=t=>t.options.get("visualchars_default_state"),Y=(t,e)=>{const n=((s,o)=>{let r=null;return{cancel:()=>{N(r)||(clearTimeout(r),r=null)},throttle:(...a)=>{N(r)&&(r=setTimeout(()=>{r=null,s.apply(null,a)},300))}}})(()=>{D(t)});t.on("keydown",s=>{e.get()===!0&&(s.keyCode===13?D(t):n.throttle())}),t.on("remove",n.cancel)},M=(t,e)=>n=>{n.setActive(e.get());const s=o=>n.setActive(o.state);return t.on("VisualChars",s),()=>t.off("VisualChars",s)};K.add("visualchars",t=>{(n=>{(0,n.options.register)("visualchars_default_state",{processor:"boolean",default:!1})})(t);const e=(n=>{let s=n;return{get:()=>s,set:o=>{s=o}}})(X(t));return((n,s)=>{n.addCommand("mceVisualChars",()=>{((o,r)=>{r.set(!r.get());const a=o.selection.getBookmark();I(o,r),o.selection.moveToBookmark(a)})(n,s)})})(t,e),((n,s)=>{const o=()=>n.execCommand("mceVisualChars");n.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:M(n,s)}),n.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:o,onSetup:M(n,s)})})(t,e),Y(t,e),((n,s)=>{n.on("init",()=>{I(n,s)})})(t,e),(n=>({isEnabled:()=>n.get()}))(e)})})();
