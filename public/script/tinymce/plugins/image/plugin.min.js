var y=Object.assign;(function(){"use strict";var Ot=tinymce.util.Tools.resolve("tinymce.PluginManager");const Lt=Object.getPrototypeOf,V=(t,e,a)=>{var s;return!!a(t,e.prototype)||((s=t.constructor)===null||s===void 0?void 0:s.name)===e.name},k=t=>e=>(a=>{const s=typeof a;return a===null?"null":s==="object"&&Array.isArray(a)?"array":s==="object"&&V(a,String,(i,r)=>r.isPrototypeOf(i))?"string":s})(e)===t,z=t=>e=>typeof e===t,p=k("string"),K=k("object"),Z=t=>((e,a)=>K(e)&&V(e,a,(s,i)=>Lt(s)===i))(t,Object),q=k("array"),Et=t=>t===null,J=z("boolean"),C=t=>!(e=>e==null)(t),Q=z("function"),jt=z("number"),Mt=()=>{};class g{constructor(e,a){this.tag=e,this.value=a}static some(e){return new g(!0,e)}static none(){return g.singletonNone}fold(e,a){return this.tag?a(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?g.some(e(this.value)):g.none()}bind(e){return this.tag?e(this.value):g.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:g.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e!=null?e:"Called getOrDie on None")}static from(e){return C(e)?g.some(e):g.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}g.singletonNone=new g(!1);const Rt=Object.keys,kt=Object.hasOwnProperty,P=(t,e)=>kt.call(t,e),zt=Array.prototype.push,L=t=>{const e=[];for(let a=0,s=t.length;a<s;++a){if(!q(t[a]))throw new Error("Arr.flatten item "+a+" was not an array, input: "+t);zt.apply(e,t[a])}return e};typeof window!="undefined"||Function("return this;")();const X=(t,e,a)=>{((s,i,r)=>{if(!(p(r)||J(r)||jt(r)))throw console.error("Invalid call to Attribute.set. Key ",i,":: Value ",r,":: Element ",s),new Error("Attribute value was not simple");s.setAttribute(i,r+"")})(t.dom,e,a)},Pt=t=>{if(t==null)throw new Error("Node cannot be null or undefined");return{dom:t}},B=Pt;var Bt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Ft=tinymce.util.Tools.resolve("tinymce.util.URI");const Y=t=>t.length>0,f=t=>e=>e.options.get(t),tt=f("image_dimensions"),Ht=f("image_advtab"),Gt=f("image_uploadtab"),Wt=f("image_prepend_url"),$t=f("image_class_list"),Vt=f("image_description"),Kt=f("image_title"),Zt=f("image_caption"),qt=f("image_list"),Jt=f("a11y_advanced_options"),Qt=f("automatic_uploads"),et=(t,e)=>Math.max(parseInt(t,10),parseInt(e,10)),E=t=>(t&&(t=t.replace(/px$/,"")),t),j=t=>(t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t),at=t=>t.nodeName==="IMG"&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder")),it=(t,e)=>{const a=t.options.get;return Ft.isDomSafe(e,"img",{allow_html_data_urls:a("allow_html_data_urls"),allow_script_urls:a("allow_script_urls"),allow_svg_data_urls:a("allow_svg_data_urls")})},b=Bt.DOM,st=t=>t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?E(t.style.marginLeft):"",rt=t=>t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?E(t.style.marginTop):"",ot=t=>t.style.borderWidth?E(t.style.borderWidth):"",I=(t,e)=>{var a;return t.hasAttribute(e)&&(a=t.getAttribute(e))!==null&&a!==void 0?a:""},nt=t=>t.parentNode!==null&&t.parentNode.nodeName==="FIGURE",U=(t,e,a)=>{a===""||a===null?t.removeAttribute(e):t.setAttribute(e,a)},lt=(t,e)=>{const a=t.getAttribute("style"),s=e(a!==null?a:"");s.length>0?(t.setAttribute("style",s),t.setAttribute("data-mce-style",s)):t.removeAttribute("style")},ct=(t,e)=>(a,s,i)=>{const r=a.style;r[s]?(r[s]=j(i),lt(a,e)):U(a,s,i)},mt=(t,e)=>t.style[e]?E(t.style[e]):I(t,e),dt=(t,e)=>{const a=j(e);t.style.marginLeft=a,t.style.marginRight=a},gt=(t,e)=>{const a=j(e);t.style.marginTop=a,t.style.marginBottom=a},ut=(t,e)=>{const a=j(e);t.style.borderWidth=a},pt=(t,e)=>{t.style.borderStyle=e},ht=t=>{var e;return(e=t.style.borderStyle)!==null&&e!==void 0?e:""},F=t=>C(t)&&t.nodeName==="FIGURE",bt=t=>b.getAttrib(t,"alt").length===0&&b.getAttrib(t,"role")==="presentation",Xt=t=>bt(t)?"":I(t,"alt"),Yt=(t,e)=>{var a;const s=document.createElement("img");return U(s,"style",e.style),(st(s)||e.hspace!=="")&&dt(s,e.hspace),(rt(s)||e.vspace!=="")&&gt(s,e.vspace),(ot(s)||e.border!=="")&&ut(s,e.border),(ht(s)||e.borderStyle!=="")&&pt(s,e.borderStyle),t((a=s.getAttribute("style"))!==null&&a!==void 0?a:"")},H=(t,e)=>({src:I(e,"src"),alt:Xt(e),title:I(e,"title"),width:mt(e,"width"),height:mt(e,"height"),class:I(e,"class"),style:t(I(e,"style")),caption:nt(e),hspace:st(e),vspace:rt(e),border:ot(e),borderStyle:ht(e),isDecorative:bt(e)}),w=(t,e,a,s,i)=>{a[s]!==e[s]&&i(t,s,String(a[s]))},vt=(t,e,a)=>{if(a){b.setAttrib(t,"role","presentation");const s=B(t);X(s,"alt","")}else{if(Et(e))B(t).dom.removeAttribute("alt");else{const s=B(t);X(s,"alt",e)}b.getAttrib(t,"role")==="presentation"&&b.setAttrib(t,"role","")}},S=(t,e)=>(a,s,i)=>{t(a,i),lt(a,e)},yt=(t,e,a)=>{const s=H(t,a);w(a,s,e,"caption",(i,r,n)=>(o=>{nt(o)?(l=>{const m=l.parentNode;C(m)&&(b.insertAfter(l,m),b.remove(m))})(o):(l=>{const m=b.create("figure",{class:"image"});b.insertAfter(m,l),m.appendChild(l),m.appendChild(b.create("figcaption",{contentEditable:"true"},"Caption")),m.contentEditable="false"})(o)})(i)),w(a,s,e,"src",U),w(a,s,e,"title",U),w(a,s,e,"width",ct(0,t)),w(a,s,e,"height",ct(0,t)),w(a,s,e,"class",U),w(a,s,e,"style",S((i,r)=>U(i,"style",r),t)),w(a,s,e,"hspace",S(dt,t)),w(a,s,e,"vspace",S(gt,t)),w(a,s,e,"border",S(ut,t)),w(a,s,e,"borderStyle",S(pt,t)),((i,r,n)=>{n.alt===r.alt&&n.isDecorative===r.isDecorative||vt(i,n.alt,n.isDecorative)})(a,s,e)},N=(t,e)=>{const a=(i=>{if(i.margin){const r=String(i.margin).split(" ");switch(r.length){case 1:i["margin-top"]=i["margin-top"]||r[0],i["margin-right"]=i["margin-right"]||r[0],i["margin-bottom"]=i["margin-bottom"]||r[0],i["margin-left"]=i["margin-left"]||r[0];break;case 2:i["margin-top"]=i["margin-top"]||r[0],i["margin-right"]=i["margin-right"]||r[1],i["margin-bottom"]=i["margin-bottom"]||r[0],i["margin-left"]=i["margin-left"]||r[1];break;case 3:i["margin-top"]=i["margin-top"]||r[0],i["margin-right"]=i["margin-right"]||r[1],i["margin-bottom"]=i["margin-bottom"]||r[2],i["margin-left"]=i["margin-left"]||r[1];break;case 4:i["margin-top"]=i["margin-top"]||r[0],i["margin-right"]=i["margin-right"]||r[1],i["margin-bottom"]=i["margin-bottom"]||r[2],i["margin-left"]=i["margin-left"]||r[3]}delete i.margin}return i})(t.dom.styles.parse(e)),s=t.dom.styles.parse(t.dom.styles.serialize(a));return t.dom.styles.serialize(s)},M=t=>{const e=t.selection.getNode(),a=t.dom.getParent(e,"figure.image");return a?t.dom.select("img",a)[0]:e&&(e.nodeName!=="IMG"||at(e))?null:e},ft=(t,e)=>{var a;const s=t.dom,i=((n,o)=>{const l={};var m;return((d,c,v,h)=>{((A,x)=>{const T=Rt(A);for(let u=0,_=T.length;u<_;u++){const D=T[u];x(A[D],D)}})(d,(A,x)=>{(c(A,x)?v:h)(A,x)})})(n,(d,c)=>!t.schema.isValidChild(c,"figure"),(m=l,(d,c)=>{m[c]=d}),Mt),l})(t.schema.getTextBlockElements()),r=s.getParent(e.parentNode,n=>{return o=i,l=n.nodeName,P(o,l)&&o[l]!==void 0&&o[l]!==null;var o,l},t.getBody());return r&&(a=s.split(r,e))!==null&&a!==void 0?a:e},te=(t,e)=>{const a=((i,r)=>{const n=document.createElement("img");if(yt(o=>N(t,o),y(y({},r),{caption:!1}),n),vt(n,r.alt,r.isDecorative),r.caption){const o=b.create("figure",{class:"image"});return o.appendChild(n),o.appendChild(b.create("figcaption",{contentEditable:"true"},"Caption")),o.contentEditable="false",o}return n})(0,e);t.dom.setAttrib(a,"data-mce-id","__mcenew"),t.focus(),t.selection.setContent(a.outerHTML);const s=t.dom.select('*[data-mce-id="__mcenew"]')[0];if(t.dom.setAttrib(s,"data-mce-id",null),F(s)){const i=ft(t,s);t.selection.select(i)}else t.selection.select(s)},ee=(t,e)=>{const a=M(t);if(a){const s=y(y({},H(r=>N(t,r),a)),e),i=((r,n)=>{const o=n.src;return y(y({},n),{src:it(r,o)?o:""})})(t,s);s.src?((r,n)=>{const o=M(r);if(o)if(yt(l=>N(r,l),n,o),((l,m)=>{l.dom.setAttrib(m,"src",m.getAttribute("src"))})(r,o),F(o.parentNode)){const l=o.parentNode;ft(r,l),r.selection.select(o.parentNode)}else r.selection.select(o),((l,m,d)=>{const c=()=>{d.onload=d.onerror=null,l.selection&&(l.selection.select(d),l.nodeChanged())};d.onload=()=>{m.width||m.height||!tt(l)||l.dom.setAttribs(d,{width:String(d.clientWidth),height:String(d.clientHeight)}),c()},d.onerror=c})(r,n,o)})(t,i):((r,n)=>{if(n){const o=r.dom.is(n.parentNode,"figure.image")?n.parentNode:n;r.dom.remove(o),r.focus(),r.nodeChanged(),r.dom.isEmpty(r.getBody())&&(r.setContent(""),r.selection.setCursorLocation())}})(t,a)}else e.src&&te(t,y({src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1},e))},G=(wt=(t,e)=>Z(t)&&Z(e)?G(t,e):e,(...t)=>{if(t.length===0)throw new Error("Can't merge zero objects");const e={};for(let a=0;a<t.length;a++){const s=t[a];for(const i in s)P(s,i)&&(e[i]=wt(e[i],s[i]))}return e});var wt,ae=tinymce.util.Tools.resolve("tinymce.util.ImageUploader"),At=tinymce.util.Tools.resolve("tinymce.util.Tools");const Dt=t=>p(t.value)?t.value:"",_t=(t,e)=>{const a=[];return At.each(t,s=>{const i=(r=>p(r.text)?r.text:p(r.title)?r.title:"")(s);if(s.menu!==void 0){const r=_t(s.menu,e);a.push({text:i,items:r})}else{const r=e(s);a.push({text:i,value:r})}}),a},Ct=(t=Dt)=>e=>e?g.from(e).map(a=>_t(a,t)):g.none(),It=(t,e)=>((a,s)=>{for(let r=0;r<a.length;r++){const n=(o=>P(o,"items"))(i=a[r])?It(i.items,e):i.value===e?g.some(i):g.none();if(n.isSome())return n}var i;return g.none()})(t),ie=Ct,R=(t,e)=>t.bind(a=>It(a,e)),se=t=>{const e=ie(u=>t.convertURL(u.value||u.url||"","src")),a=new Promise(u=>{((_,D)=>{const O=qt(_);p(O)?fetch(O).then(Tt=>{Tt.ok&&Tt.json().then(D)}):Q(O)?O(D):D(O)})(t,_=>{u(e(_).map(D=>L([[{text:"None",value:""}],D])))})}),s=(T=$t(t),Ct(Dt)(T)),i=Ht(t),r=Gt(t),n=(u=>Y(u.options.get("images_upload_url")))(t),o=(u=>C(u.options.get("images_upload_handler")))(t),l=(u=>{const _=M(u);return _?H(D=>N(u,D),_):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}})(t),m=Vt(t),d=Kt(t),c=tt(t),v=Zt(t),h=Jt(t),A=Qt(t),x=g.some(Wt(t)).filter(u=>p(u)&&u.length>0);var T;return a.then(u=>({image:l,imageList:u,classList:s,hasAdvTab:i,hasUploadTab:r,hasUploadUrl:n,hasUploadHandler:o,hasDescription:m,hasImageTitle:d,hasDimensions:c,hasImageCaption:v,prependURL:x,hasAccessibilityOptions:h,automaticUploads:A}))},Ut=t=>{const e=t.imageList.map(r=>({name:"images",type:"listbox",label:"Image list",items:r})),a={name:"alt",type:"input",label:"Alternative description",enabled:!(t.hasAccessibilityOptions&&t.image.isDecorative)},s=t.classList.map(r=>({name:"classes",type:"listbox",label:"Class",items:r}));return L([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],e.toArray(),t.hasAccessibilityOptions&&t.hasDescription?[{type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]}]:[],t.hasDescription?[a]:[],t.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],t.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[y(y({},(i=t.classList.isSome()&&t.hasImageCaption,i?{type:"grid",columns:2}:{type:"panel"})),{items:L([s.toArray(),t.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])})]]);var i},re=t=>({title:"General",name:"general",items:Ut(t)}),oe=Ut,xt=t=>({src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:t.caption,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[],isDecorative:t.isDecorative}),St=(t,e)=>({src:t.src.value,alt:t.alt!==null&&t.alt.length!==0||!e?t.alt:null,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle,isDecorative:t.isDecorative}),W=(t,e,a,s)=>{((i,r)=>{const n=r.getData();((o,l)=>/^(?:[a-zA-Z]+:)?\/\//.test(l)?g.none():o.prependURL.bind(m=>l.substring(0,m.length)!==m?g.some(m+l):g.none()))(i,n.src.value).each(o=>{r.setData({src:{value:o,meta:n.src.meta}})})})(e,s),((i,r)=>{const n=r.getData(),o=n.src.meta;if(o!==void 0){const l=G({},n);((m,d,c)=>{m.hasDescription&&p(c.alt)&&(d.alt=c.alt),m.hasAccessibilityOptions&&(d.isDecorative=c.isDecorative||d.isDecorative||!1),m.hasImageTitle&&p(c.title)&&(d.title=c.title),m.hasDimensions&&(p(c.width)&&(d.dimensions.width=c.width),p(c.height)&&(d.dimensions.height=c.height)),p(c.class)&&R(m.classList,c.class).each(v=>{d.classes=v.value}),m.hasImageCaption&&J(c.caption)&&(d.caption=c.caption),m.hasAdvTab&&(p(c.style)&&(d.style=c.style),p(c.vspace)&&(d.vspace=c.vspace),p(c.border)&&(d.border=c.border),p(c.hspace)&&(d.hspace=c.hspace),p(c.borderstyle)&&(d.borderstyle=c.borderstyle))})(i,l,o),r.setData(l)}})(e,s),((i,r,n,o)=>{const l=o.getData(),m=l.src.value,d=l.src.meta||{};d.width||d.height||!r.hasDimensions||(Y(m)?i.imageSize(m).then(c=>{n.open&&o.setData({dimensions:c})}).catch(c=>console.error(c)):o.setData({dimensions:{width:"",height:""}}))})(t,e,a,s),((i,r,n)=>{const o=n.getData(),l=R(i.imageList,o.src.value);r.prevImage=l,n.setData({images:l.map(m=>m.value).getOr("")})})(e,a,s)},ne=(t,e,a,s)=>{const i=s.getData();var r;s.block("Uploading image"),(r=i.fileinput,((n,o)=>0<n.length?g.some(n[0]):g.none())(r)).fold(()=>{s.unblock()},n=>{const o=URL.createObjectURL(n),l=()=>{s.unblock(),URL.revokeObjectURL(o)},m=c=>{s.setData({src:{value:c,meta:{}}}),s.showTab("general"),W(t,e,a,s)};var d;(d=n,new Promise((c,v)=>{const h=new FileReader;h.onload=()=>{c(h.result)},h.onerror=()=>{var A;v((A=h.error)===null||A===void 0?void 0:A.message)},h.readAsDataURL(d)})).then(c=>{const v=t.createBlobCache(n,o,c);e.automaticUploads?t.uploadImage(v).then(h=>{m(h.url),l()}).catch(h=>{l(),t.alertErr(h)}):(t.addToBlobCache(v),m(v.blobUri()),s.unblock())})})},le=(t,e,a)=>(s,i)=>{i.name==="src"?W(t,e,a,s):i.name==="images"?((r,n,o,l)=>{const m=l.getData(),d=R(n.imageList,m.images);d.each(c=>{m.alt===""||o.prevImage.map(h=>h.text===m.alt).getOr(!1)?c.value===""?l.setData({src:c,alt:o.prevAlt}):l.setData({src:c,alt:c.text}):l.setData({src:c})}),o.prevImage=d,W(r,n,o,l)})(t,e,a,s):i.name==="alt"?a.prevAlt=s.getData().alt:i.name==="fileinput"?ne(t,e,a,s):i.name==="isDecorative"&&s.setEnabled("alt",!s.getData().isDecorative)},ce=t=>()=>{t.open=!1},me=t=>t.hasAdvTab||t.hasUploadUrl||t.hasUploadHandler?{type:"tabpanel",tabs:L([[re(t)],t.hasAdvTab?[{title:"Advanced",name:"advanced",items:[{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"listbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}]:[],t.hasUploadTab&&(t.hasUploadUrl||t.hasUploadHandler)?[{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}]:[]])}:{type:"panel",items:oe(t)},de=(t,e,a)=>s=>{const i=G(xt(e.image),s.getData()),r=y(y({},i),{style:Yt(a.normalizeCss,St(i,!1))});t.execCommand("mceUpdateImage",!1,St(r,e.hasAccessibilityOptions)),t.editorUpload.uploadImagesAuto(),s.close()},ge=t=>e=>it(t,e)?(a=>new Promise(s=>{const i=document.createElement("img"),r=o=>{i.onload=i.onerror=null,i.parentNode&&i.parentNode.removeChild(i),s(o)};i.onload=()=>{const o={width:et(i.width,i.clientWidth),height:et(i.height,i.clientHeight)};r(Promise.resolve(o))},i.onerror=()=>{r(Promise.reject(`Failed to get image dimensions for: ${a}`))};const n=i.style;n.visibility="hidden",n.position="fixed",n.bottom=n.left="0px",n.width=n.height="auto",document.body.appendChild(i),i.src=a}))(t.documentBaseURI.toAbsolute(e)).then(a=>({width:String(a.width),height:String(a.height)})):Promise.resolve({width:"",height:""}),ue=t=>(e,a,s)=>{var i;return t.editorUpload.blobCache.create({blob:e,blobUri:a,name:(i=e.name)===null||i===void 0?void 0:i.replace(/\.[^\.]+$/,""),filename:e.name,base64:s.split(",")[1]})},pe=t=>e=>{t.editorUpload.blobCache.add(e)},he=t=>e=>{t.windowManager.alert(e)},be=t=>e=>N(t,e),ve=t=>e=>t.dom.parseStyle(e),ye=t=>(e,a)=>t.dom.serializeStyle(e,a),fe=t=>e=>ae(t).upload([e],!1).then(a=>{var s;return a.length===0?Promise.reject("Failed to upload image"):a[0].status===!1?Promise.reject((s=a[0].error)===null||s===void 0?void 0:s.message):a[0]}),$=t=>{const e={imageSize:ge(t),addToBlobCache:pe(t),createBlobCache:ue(t),alertErr:he(t),normalizeCss:be(t),parseStyle:ve(t),serializeStyle:ye(t),uploadImage:fe(t)};return{open:()=>{se(t).then(a=>{const s=(i=>({prevImage:R(i.imageList,i.image.src),prevAlt:i.image.alt,open:!0}))(a);return{title:"Insert/Edit Image",size:"normal",body:me(a),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:xt(a.image),onSubmit:de(t,a,e),onChange:le(e,a,s),onClose:ce(s)}}).then(t.windowManager.open)}}},we=t=>{const e=t.attr("class");return C(e)&&/\bimage\b/.test(e)},Nt=t=>e=>{let a=e.length;const s=i=>{i.attr("contenteditable",t?"true":null)};for(;a--;){const i=e[a];we(i)&&(i.attr("contenteditable",t?"false":null),At.each(i.getAll("figcaption"),s))}};Ot.add("image",t=>{(e=>{const a=e.options.register;a("image_dimensions",{processor:"boolean",default:!0}),a("image_advtab",{processor:"boolean",default:!1}),a("image_uploadtab",{processor:"boolean",default:!0}),a("image_prepend_url",{processor:"string",default:""}),a("image_class_list",{processor:"object[]"}),a("image_description",{processor:"boolean",default:!0}),a("image_title",{processor:"boolean",default:!1}),a("image_caption",{processor:"boolean",default:!1}),a("image_list",{processor:s=>{const i=s===!1||p(s)||((r,n)=>{if(q(r)){for(let o=0,l=r.length;o<l;++o)if(!n(r[o]))return!1;return!0}return!1})(s,K)||Q(s);return i?{value:s,valid:i}:{valid:!1,message:"Must be false, a string, an array or a function."}},default:!1})})(t),(e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("figure",Nt(!0)),e.serializer.addNodeFilter("figure",Nt(!1))})})(t),(e=>{e.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:$(e).open,onSetup:a=>(a.setActive(C(M(e))),e.selection.selectorChangedWithUnbind("img:not([data-mce-object]):not([data-mce-placeholder]),figure.image",a.setActive).unbind)}),e.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:$(e).open}),e.ui.registry.addContextMenu("image",{update:a=>F(a)||a.nodeName==="IMG"&&!at(a)?["image"]:[]})})(t),(e=>{e.addCommand("mceImage",$(e).open),e.addCommand("mceUpdateImage",(a,s)=>{e.undoManager.transact(()=>ee(e,s))})})(t)})})();
