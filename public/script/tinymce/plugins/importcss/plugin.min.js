(function(){"use strict";var M=tinymce.util.Tools.resolve("tinymce.PluginManager");const x=t=>c=>(s=>{const p=typeof s;return s===null?"null":p==="object"&&Array.isArray(s)?"array":p==="object"&&(u=_=s,(b=String).prototype.isPrototypeOf(u)||((i=_.constructor)===null||i===void 0?void 0:i.name)===b.name)?"string":p;var u,_,b,i})(c)===t,T=x("string"),j=x("object"),O=x("array"),R=t=>typeof t=="function";var U=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),k=tinymce.util.Tools.resolve("tinymce.EditorManager"),B=tinymce.util.Tools.resolve("tinymce.Env"),y=tinymce.util.Tools.resolve("tinymce.util.Tools");const h=t=>c=>c.options.get(t),D=h("importcss_merge_classes"),F=h("importcss_exclusive"),L=h("importcss_selector_converter"),z=h("importcss_selector_filter"),C=h("importcss_groups"),G=h("importcss_append"),P=h("importcss_file_filter"),$=h("skin"),q=h("skin_url"),H=Array.prototype.push,J=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,S=t=>T(t)?c=>c.indexOf(t)!==-1:t instanceof RegExp?c=>t.test(c):t,w=(t,c)=>{let s={};const p=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(c);if(!p)return;const u=p[1],_=p[2].substr(1).split(".").join(" "),b=y.makeMap("a,img");return p[1]?(s={title:c},t.schema.getTextBlockElements()[u]?s.block=u:t.schema.getBlockElements()[u]||b[u.toLowerCase()]?s.selector=u:s.inline=u):p[2]&&(s={inline:"span",title:c.substr(1),classes:_}),D(t)?s.classes=_:s.attributes={class:_},s},A=(t,c)=>c===null||F(t),K=t=>{t.on("init",()=>{const c=(()=>{const i=[],m=[],r={};return{addItemToGroup:(e,l)=>{r[e]?r[e].push(l):(m.push(e),r[e]=[l])},addItem:e=>{i.push(e)},toFormats:()=>{return(e=m,l=n=>{const o=r[n];return o.length===0?[]:[{title:n,items:o}]},(n=>{const o=[];for(let f=0,g=n.length;f<g;++f){if(!O(n[f]))throw new Error("Arr.flatten item "+f+" was not an array, input: "+n);H.apply(o,n[f])}return o})(((n,o)=>{const f=n.length,g=new Array(f);for(let d=0;d<f;d++){const a=n[d];g[d]=o(a,d)}return g})(e,l))).concat(i);var e,l}}})(),s={},p=S(z(t)),u=(i=>y.map(i,m=>y.extend({},m,{original:m,selectors:{},filter:S(m.filter)})))(C(t)),_=(i,m)=>{if(((r,e,l,n)=>!(A(r,l)?e in n:e in l.selectors))(t,i,m,s)){((e,l,n,o)=>{A(e,n)?o[l]=!0:n.selectors[l]=!0})(t,i,m,s);const r=((e,l,n,o)=>{let f;const g=L(e);return f=o&&o.selector_converter?o.selector_converter:g||(()=>w(e,n)),f.call(l,n,o)})(t,t.plugins.importcss,i,m);if(r){const e=r.name||U.DOM.uniqueId();return t.formatter.register(e,r),{title:r.title,format:e}}}return null};y.each(((i,m,r)=>{const e=[],l={},n=(o,f)=>{let g,d=o.href;if(d=(a=>{const v=B.cacheSuffix;return T(a)&&(a=a.replace("?"+v,"").replace("&"+v,"")),a})(d),d&&(!r||r(d,f))&&!((a,v)=>{const E=$(a);if(E){const I=q(a),N=I?a.documentBaseURI.toAbsolute(I):k.baseURL+"/skins/ui/"+E,Q=k.baseURL+"/skins/content/";return v===N+"/content"+(a.inline?".inline":"")+".min.css"||v.indexOf(Q)!==-1}return!1})(i,d)){y.each(o.imports,a=>{n(a,!0)});try{g=o.cssRules||o.rules}catch(a){}y.each(g,a=>{a.styleSheet?n(a.styleSheet,!0):a.selectorText&&y.each(a.selectorText.split(","),v=>{e.push(y.trim(v))})})}};y.each(i.contentCSS,o=>{l[o]=!0}),r||(r=(o,f)=>f||l[o]);try{y.each(m.styleSheets,o=>{n(o)})}catch(o){}return e})(t,t.getDoc(),S(P(t))),i=>{if(!J.test(i)&&(!p||p(i))){const m=((r,e)=>y.grep(r,l=>!l.filter||l.filter(e)))(u,i);if(m.length>0)y.each(m,r=>{const e=_(i,r);e&&c.addItemToGroup(r.title,e)});else{const r=_(i,null);r&&c.addItem(r)}}});const b=c.toFormats();t.dispatch("addStyleModifications",{items:b,replace:!G(t)})})};M.add("importcss",t=>((c=>{const s=c.options.register,p=u=>T(u)||R(u)||j(u);s("importcss_merge_classes",{processor:"boolean",default:!0}),s("importcss_exclusive",{processor:"boolean",default:!0}),s("importcss_selector_converter",{processor:"function"}),s("importcss_selector_filter",{processor:p}),s("importcss_file_filter",{processor:p}),s("importcss_groups",{processor:"object[]"}),s("importcss_append",{processor:"boolean",default:!1})})(t),K(t),(c=>({convertSelectorToFormat:s=>w(c,s)}))(t)))})();
