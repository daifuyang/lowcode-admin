var b=Object.assign;(function(){"use strict";const P=t=>{let e=t;return{get:()=>e,set:n=>{e=n}}};var ie=tinymce.util.Tools.resolve("tinymce.PluginManager");const D=t=>e=>(n=>{const o=typeof n;return n===null?"null":o==="object"&&Array.isArray(n)?"array":o==="object"&&(a=c=n,(s=String).prototype.isPrototypeOf(a)||((u=c.constructor)===null||u===void 0?void 0:u.name)===s.name)?"string":o;var a,c,s,u})(e)===t,W=t=>e=>typeof e===t,de=D("string"),fe=D("array"),he=W("boolean"),me=W("number"),ge=()=>{},$=t=>()=>t,V=$(!0),pe=$("[!-#%-*,-\\/:;?@\\[-\\]_{}\xA1\xAB\xB7\xBB\xBF;\xB7\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1361-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u3008\u3009\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30\u2E31\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]");class p{constructor(e,n){this.tag=e,this.value=n}static some(e){return new p(!0,e)}static none(){return p.singletonNone}fold(e,n){return this.tag?n(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?p.some(e(this.value)):p.none()}bind(e){return this.tag?e(this.value):p.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:p.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e!=null?e:"Called getOrDie on None")}static from(e){return e==null?p.none():p.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}p.singletonNone=new p(!1);const j=pe;var S=tinymce.util.Tools.resolve("tinymce.Env"),C=tinymce.util.Tools.resolve("tinymce.util.Tools");const xe=Array.prototype.slice,be=Array.prototype.push,O=(t,e)=>{const n=t.length,o=new Array(n);for(let a=0;a<n;a++){const c=t[a];o[a]=e(c,a)}return o},z=(t,e)=>{for(let n=0,o=t.length;n<o;n++)e(t[n],n)},U=(t,e)=>{for(let n=t.length-1;n>=0;n--)e(t[n],n)},N=(t,e)=>(n=>{const o=[];for(let a=0,c=n.length;a<c;++a){if(!fe(n[a]))throw new Error("Arr.flatten item "+a+" was not an array, input: "+n);be.apply(o,n[a])}return o})(O(t,e)),ye=Object.hasOwnProperty,q=(t,e)=>ye.call(t,e);typeof window!="undefined"||Function("return this;")();const we=t=>(e=>e.dom.nodeType)(t)===3,ve=t=>{if(t==null)throw new Error("Node cannot be null or undefined");return{dom:t}},y=ve,G=(t,e)=>({element:t,offset:e}),K=(t,e)=>{((n,o)=>{(c=>p.from(c.dom.parentNode).map(y))(n).each(c=>{c.dom.insertBefore(o.dom,n.dom)})})(t,e),((n,o)=>{n.dom.appendChild(o.dom)})(e,t)},Ce=((t,e)=>{const n=o=>t(o)?p.from(o.dom.nodeValue):p.none();return{get:o=>{if(!t(o))throw new Error("Can only get text value of a text node");return n(o).getOr("")},getOption:n,set:(o,a)=>{if(!t(o))throw new Error("Can only set raw text value of a text node");o.dom.nodeValue=a}}})(we),H=t=>Ce.get(t);var J=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");const L=(t,e)=>t.isBlock(e)||q(t.schema.getVoidElements(),e.nodeName),Q=(t,e)=>t.getContentEditable(e)==="false",X=(t,e)=>!t.isBlock(e)&&q(t.schema.getWhitespaceElements(),e.nodeName),Y=(t,e)=>((n,o)=>{const a=(c=>O(c.dom.childNodes,y))(n);return a.length>0&&o<a.length?G(a[o],0):G(n,o)})(y(t),e),Z=(t,e,n,o,a,c=!0)=>{let s=c?e(!1):n;for(;s;){const u=Q(t,s);if(u||X(t,s)){if(u?o.cef(s):o.boundary(s))break;s=e(!0)}else{if(L(t,s)){if(o.boundary(s))break}else s.nodeType===3&&o.text(s);if(s===a)break;s=e(!1)}}},_=(t,e,n,o,a)=>{var c;if(((h,i)=>L(h,i)||Q(h,i)||X(h,i)||((r,l)=>r.getContentEditable(l)==="true"&&l.parentNode&&r.getContentEditableParent(l.parentNode)==="false")(h,i))(t,n))return;const s=(c=t.getParent(o,t.isBlock))!==null&&c!==void 0?c:t.getRoot(),u=new J(n,s),f=a?u.next.bind(u):u.prev.bind(u);Z(t,f,n,{boundary:V,cef:V,text:h=>{a?e.fOffset+=h.length:e.sOffset+=h.length,e.elements.push(y(h))}})},ee=(t,e,n,o,a,c=!0)=>{const s=new J(n,e),u=[];let f={sOffset:0,fOffset:0,elements:[]};_(t,f,n,e,!1);const h=()=>(f.elements.length>0&&(u.push(f),f={sOffset:0,fOffset:0,elements:[]}),!1);return Z(t,s.next.bind(s),n,{boundary:h,cef:i=>(h(),a&&u.push(...a.cef(i)),!1),text:i=>{f.elements.push(y(i)),a&&a.text(i,f)}},o,c),o&&_(t,f,o,e,!0),h(),u},Ee=(t,e)=>{const n=Y(e.startContainer,e.startOffset),o=n.element.dom,a=Y(e.endContainer,e.endOffset),c=a.element.dom;return ee(t,e.commonAncestorContainer,o,c,{text:(s,u)=>{s===c?u.fOffset+=s.length-a.offset:s===o&&(u.sOffset+=n.offset)},cef:s=>{return((f,h)=>{const i=xe.call(f,0);return i.sort((r,l)=>((d,g)=>((m,x,w)=>(m.compareDocumentPosition(x)&w)!=0)(d,g,Node.DOCUMENT_POSITION_PRECEDING))(r.elements[0].dom,l.elements[0].dom)?1:-1),i})(N((u=y(s),((f,h)=>{const i=h===void 0?document:h.dom;return(r=i).nodeType!==1&&r.nodeType!==9&&r.nodeType!==11||r.childElementCount===0?[]:O(i.querySelectorAll(f),y);var r})("*[contenteditable=true]",u)),f=>{const h=f.dom;return ee(t,h,h)}));var u}},!1)},te=(t,e)=>e.collapsed?[]:Ee(t,e),ne=(t,e)=>{const n=t.createRng();return n.selectNode(e),te(t,n)},ae=(t,e)=>N(e,n=>{const o=n.elements,a=O(o,H).join(""),c=((s,u,f=0,h=s.length)=>{const i=u.regex;i.lastIndex=f;const r=[];let l;for(;l=i.exec(s);){const d=l[u.matchIndex],g=l.index+l[0].indexOf(d),m=g+d.length;if(m>h)break;r.push({start:g,finish:m}),i.lastIndex=m}return r})(a,t,n.sOffset,a.length-n.fOffset);return((s,u)=>{const f=(h=s,i=(l,d)=>{const g=H(d),m=l.last,x=m+g.length,w=N(u,(v,A)=>v.start<x&&v.finish>m?[{element:d,start:Math.max(m,v.start)-m,finish:Math.min(x,v.finish)-m,matchId:A}]:[]);return{results:l.results.concat(w),last:x}},r={results:[],last:0},z(h,(l,d)=>{r=i(r,l)}),r).results;var h,i,r;return((l,d)=>{if(l.length===0)return[];{let g=d(l[0]);const m=[];let x=[];for(let w=0,v=l.length;w<v;w++){const A=l[w],ce=d(A);ce!==g&&(m.push(x),x=[]),g=ce,x.push(A)}return x.length!==0&&m.push(x),m}})(f,l=>l.matchId)})(o,c)}),oe=(t,e)=>{U(t,(n,o)=>{U(n,a=>{const c=y(e.cloneNode(!1));((u,f,h)=>{((i,r,l)=>{if(!(de(l)||he(l)||me(l)))throw console.error("Invalid call to Attribute.set. Key ",r,":: Value ",l,":: Element ",i),new Error("Attribute value was not simple");i.setAttribute(r,l+"")})(u.dom,f,h)})(c,"data-mce-index",o);const s=a.element.dom;if(s.length===a.finish&&a.start===0)K(a.element,c);else{s.length!==a.finish&&s.splitText(a.finish);const u=s.splitText(a.start);K(y(u),c)}})})},E=t=>t.getAttribute("data-mce-index"),Oe=(t,e,n,o)=>{const a=t.dom.create("span",{"data-mce-bogus":1});a.className="mce-match-marker";const c=t.getBody();return k(t,e,!1),o?((s,u,f,h)=>{const i=f.getBookmark(),r=s.select("td[data-mce-selected],th[data-mce-selected]"),l=r.length>0?((g,m)=>N(m,x=>ne(g,x)))(s,r):te(s,f.getRng()),d=ae(u,l);return oe(d,h),f.moveToBookmark(i),d.length})(t.dom,n,t.selection,a):((s,u,f,h)=>{const i=ne(s,f),r=ae(u,i);return oe(r,h),r.length})(t.dom,n,c,a)},re=t=>{var e;const n=t.parentNode;t.firstChild&&n.insertBefore(t.firstChild,t),(e=t.parentNode)===null||e===void 0||e.removeChild(t)},B=(t,e)=>{const n=[],o=C.toArray(t.getBody().getElementsByTagName("span"));if(o.length)for(let a=0;a<o.length;a++){const c=E(o[a]);c!==null&&c.length&&c===e.toString()&&n.push(o[a])}return n},F=(t,e,n)=>{const o=e.get();let a=o.index;const c=t.dom;n?a+1===o.count?a=0:a++:a-1==-1?a=o.count-1:a--,c.removeClass(B(t,o.index),"mce-match-marker-selected");const s=B(t,a);return s.length?(c.addClass(B(t,a),"mce-match-marker-selected"),t.selection.scrollIntoView(s[0]),a):-1},se=(t,e)=>{const n=e.parentNode;t.remove(e),n&&t.isEmpty(n)&&t.remove(n)},ue=(t,e,n,o,a,c)=>{const s=t.selection,u=((r,l)=>{const d="("+r.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return l?`(?:^|\\s|${j()})`+d+`(?=$|\\s|${j()})`:d})(n,a),f=s.isForward(),h={regex:new RegExp(u,o?"g":"gi"),matchIndex:1},i=Oe(t,e,h,c);if(S.browser.isSafari()&&s.setRng(s.getRng(),f),i){const r=F(t,e,!0);e.set({index:r,count:i,text:n,matchCase:o,wholeWord:a,inSelection:c})}return i},T=(t,e)=>{const n=F(t,e,!0);e.set(b(b({},e.get()),{index:n}))},I=(t,e)=>{const n=F(t,e,!1);e.set(b(b({},e.get()),{index:n}))},Ne=t=>{const e=E(t);return e!==null&&e.length>0},M=(t,e,n,o,a)=>{const c=e.get(),s=c.index;let u,f=s;o=o!==!1;const h=t.getBody(),i=C.grep(C.toArray(h.getElementsByTagName("span")),Ne);for(let r=0;r<i.length;r++){const l=E(i[r]);let d=u=parseInt(l,10);if(a||d===c.index){for(n.length?(i[r].innerText=n,re(i[r])):se(t.dom,i[r]);i[++r];){if(d=parseInt(E(i[r]),10),d!==u){r--;break}se(t.dom,i[r])}o&&f--}else u>s&&i[r].setAttribute("data-mce-index",String(u-1))}return e.set(b(b({},c),{count:a?0:c.count-1,index:f})),o?T(t,e):I(t,e),!a&&e.get().count>0},k=(t,e,n)=>{let o,a;const c=e.get(),s=C.toArray(t.getBody().getElementsByTagName("span"));for(let u=0;u<s.length;u++){const f=E(s[u]);f!==null&&f.length&&(f===c.index.toString()&&(o||(o=s[u].firstChild),a=s[u].firstChild),re(s[u]))}if(e.set(b(b({},c),{index:-1,count:0,text:""})),o&&a){const u=t.dom.createRng();return u.setStart(o,0),u.setEnd(a,a.data.length),n!==!1&&t.selection.setRng(u),u}},le=(t,e)=>{const n=(()=>{const r=(l=>{const d=P(p.none()),g=()=>d.get().each(l);return{clear:()=>{g(),d.set(p.none())},isSet:()=>d.get().isSome(),get:()=>d.get(),set:m=>{g(),d.set(p.some(m))}}})(ge);return b(b({},r),{on:l=>r.get().each(l)})})();t.undoManager.add();const o=C.trim(t.selection.getContent({format:"text"})),a=r=>{r.setEnabled("next",((l,d)=>d.get().count>1)(0,e)),r.setEnabled("prev",((l,d)=>d.get().count>1)(0,e))},c=(r,l)=>{z(["replace","replaceall","prev","next"],d=>r.setEnabled(d,!l))},s=(r,l)=>{S.browser.isSafari()&&S.deviceType.isTouch()&&(l==="find"||l==="replace"||l==="replaceall")&&r.focus(l)},u=r=>{k(t,e,!1),c(r,!0),a(r)},f=r=>{const l=r.getData(),d=e.get();if(l.findtext.length){if(d.text===l.findtext&&d.matchCase===l.matchcase&&d.wholeWord===l.wholewords)T(t,e);else{const g=ue(t,e,l.findtext,l.matchcase,l.wholewords,l.inselection);g<=0&&(m=>{t.windowManager.alert("Could not find the specified string.",()=>{m.focus("findtext")})})(r),c(r,g===0)}a(r)}else u(r)},h=e.get(),i={title:"Find and Replace",size:"normal",body:{type:"panel",items:[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}]},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:{findtext:o,replacetext:"",wholewords:h.wholeWord,matchcase:h.matchCase,inselection:h.inSelection},onChange:(r,l)=>{l.name==="findtext"&&e.get().count>0&&u(r)},onAction:(r,l)=>{const d=r.getData();switch(l.name){case"find":f(r);break;case"replace":M(t,e,d.replacetext)?a(r):u(r);break;case"replaceall":M(t,e,d.replacetext,!0,!0),u(r);break;case"prev":I(t,e),a(r);break;case"next":T(t,e),a(r);break;case"matchcase":case"wholewords":case"inselection":(g=>{const m=g.getData(),x=e.get();e.set(b(b({},x),{matchCase:m.matchcase,wholeWord:m.wholewords,inSelection:m.inselection}))})(r),u(r)}s(r,l.name)},onSubmit:r=>{f(r),s(r,"find")},onClose:()=>{t.focus(),k(t,e),t.undoManager.add()}};n.set(t.windowManager.open(i,{inline:"toolbar"}))},R=(t,e)=>()=>{le(t,e)};ie.add("searchreplace",t=>{const e=P({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return((n,o)=>{n.addCommand("SearchReplace",()=>{le(n,o)})})(t,e),((n,o)=>{n.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:R(n,o),icon:"search"}),n.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:R(n,o),icon:"search"}),n.shortcuts.add("Meta+F","",R(n,o))})(t,e),((n,o)=>({done:a=>k(n,o,a),find:(a,c,s,u=!1)=>ue(n,o,a,c,s,u),next:()=>T(n,o),prev:()=>I(n,o),replace:(a,c,s)=>M(n,o,a,c,s)}))(t,e)})})();
