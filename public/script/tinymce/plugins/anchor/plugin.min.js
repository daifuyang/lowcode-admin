(function(){"use strict";var p=tinymce.util.Tools.resolve("tinymce.PluginManager"),b=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),y=tinymce.util.Tools.resolve("tinymce.util.Tools");const A=t=>t.options.get("allow_html_in_named_anchor"),l="a:not([href])",s=t=>!t,d=t=>t.getAttribute("id")||t.getAttribute("name")||"",c=t=>(e=>e.nodeName.toLowerCase()==="a")(t)&&!t.getAttribute("href")&&d(t)!=="",m=t=>t.dom.getParent(t.selection.getStart(),l),v=(t,e)=>{const n=m(t);n?((o,r,a)=>{a.removeAttribute("name"),a.id=r,o.addVisual(),o.undoManager.add()})(t,e,n):((o,r)=>{o.undoManager.transact(()=>{A(o)||o.selection.collapse(!0),o.selection.isCollapsed()?o.insertContent(o.dom.createHTML("a",{id:r})):((a=>{const i=a.dom;b(i).walk(a.selection.getRng(),_=>{y.each(_,h=>{var g;c(g=h)&&!g.firstChild&&i.remove(h,!1)})})})(o),o.formatter.remove("namedAnchor",void 0,void 0,!0),o.formatter.apply("namedAnchor",{value:r}),o.addVisual())})})(t,e),t.focus()},f=t=>(e=>s(e.attr("href"))&&!s(e.attr("id")||e.attr("name")))(t)&&!t.firstChild,u=t=>e=>{for(let n=0;n<e.length;n++){const o=e[n];f(o)&&o.attr("contenteditable",t)}};p.add("anchor",t=>{(e=>{(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1})})(t),(e=>{e.on("PreInit",()=>{e.parser.addNodeFilter("a",u("false")),e.serializer.addNodeFilter("a",u(null))})})(t),(e=>{e.addCommand("mceAnchor",()=>{(n=>{const o=(r=>{const a=m(r);return a?d(a):""})(n);n.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:o},onSubmit:r=>{((a,i)=>/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(i)?(v(a,i),!0):(a.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1))(n,r.getData().id)&&r.close()}})})(e)})})(t),(e=>{const n=()=>e.execCommand("mceAnchor");e.ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:n,onSetup:o=>e.selection.selectorChangedWithUnbind("a:not([href])",o.setActive).unbind}),e.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:n})})(t),t.on("PreInit",()=>{(e=>{e.formatter.register("namedAnchor",{inline:"a",selector:l,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(n,o,r)=>c(n)})})(t)})})})();
