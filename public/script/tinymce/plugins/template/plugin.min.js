(function(){"use strict";var B=tinymce.util.Tools.resolve("tinymce.PluginManager");const O=n=>e=>(t=>{const a=typeof t;return t===null?"null":a==="object"&&Array.isArray(t)?"array":a==="object"&&(s=l=t,(o=String).prototype.isPrototypeOf(s)||((r=l.constructor)===null||r===void 0?void 0:r.name)===o.name)?"string":a;var s,l,o,r})(e)===n,N=O("string"),F=O("object"),$=O("array"),M=n=>typeof n=="function",R=()=>!1;var f=tinymce.util.Tools.resolve("tinymce.util.Tools");const d=n=>e=>e.options.get(n),U=d("template_cdate_classes"),k=d("template_mdate_classes"),K=d("template_selected_content_classes"),W=d("template_preview_replace_values"),P=d("template_replace_values"),q=d("templates"),z=d("template_cdate_format"),E=d("template_mdate_format"),V=d("content_style"),G=d("content_css_cors"),Q=d("body_class"),_=(n,e)=>{if((n=""+n).length<e)for(let t=0;t<e-n.length;t++)n="0"+n;return n},T=(n,e,t=new Date)=>{const a="Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),s="Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),l="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),o="January February March April May June July August September October November December".split(" ");return(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace("%D","%m/%d/%Y")).replace("%r","%I:%M:%S %p")).replace("%Y",""+t.getFullYear())).replace("%y",""+t.getYear())).replace("%m",_(t.getMonth()+1,2))).replace("%d",_(t.getDate(),2))).replace("%H",""+_(t.getHours(),2))).replace("%M",""+_(t.getMinutes(),2))).replace("%S",""+_(t.getSeconds(),2))).replace("%I",""+((t.getHours()+11)%12+1))).replace("%p",t.getHours()<12?"AM":"PM")).replace("%B",""+n.translate(o[t.getMonth()]))).replace("%b",""+n.translate(l[t.getMonth()]))).replace("%A",""+n.translate(s[t.getDay()]))).replace("%a",""+n.translate(a[t.getDay()]))).replace("%%","%")};class i{constructor(e,t){this.tag=e,this.value=t}static some(e){return new i(!0,e)}static none(){return i.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?i.some(e(this.value)):i.none()}bind(e){return this.tag?e(this.value):i.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:i.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e!=null?e:"Called getOrDie on None")}static from(e){return e==null?i.none():i.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}i.singletonNone=new i(!1);const X=Object.hasOwnProperty,Z={'"':"&quot;","<":"&lt;",">":"&gt;","&":"&amp;","'":"&#039;"},ee=n=>n.replace(/["'<>&]/g,e=>{return(t=Z,a=e,((s,l)=>X.call(s,l))(t,a)?i.from(t[a]):i.none()).getOr(e);var t,a}),x=(n,e,t)=>((a,s)=>{for(let o=0,r=a.length;o<r;o++)if(l=a[o],n.hasClass(e,l))return!0;var l;return!1})(t.split(/\s+/)),H=(n,e)=>(f.each(e,(t,a)=>{M(t)&&(t=t(a)),n=n.replace(new RegExp("\\{\\$"+a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\}","g"),t)}),n),L=(n,e)=>{const t=n.dom,a=P(n);f.each(t.select("*",e),s=>{f.each(a,(l,o)=>{t.hasClass(s,o)&&M(l)&&l(s)})})},te=(n,e,t)=>{const a=n.dom,s=n.selection.getContent();t=H(t,P(n));let l=a.create("div",{},t);const o=a.select(".mceTmpl",l);o&&o.length>0&&(l=a.create("div"),l.appendChild(o[0].cloneNode(!0))),f.each(a.select("*",l),r=>{x(a,r,U(n))&&(r.innerHTML=T(n,z(n))),x(a,r,k(n))&&(r.innerHTML=T(n,E(n))),x(a,r,K(n))&&(r.innerHTML=s)}),L(n,l),n.execCommand("mceInsertContent",!1,l.innerHTML),n.addVisual()};var j=tinymce.util.Tools.resolve("tinymce.Env");const ne=(n,e)=>{const t=(r,m)=>((c,h,g)=>{for(let u=0,v=c.length;u<v;u++){const y=c[u];if(h(y,u))return i.some(y);if(g(y,u))break}return i.none()})(r,c=>c.text===m,R),a=r=>{n.windowManager.alert("Could not load the specified template.",()=>r.focus("template"))},s=r=>r.value.url.fold(()=>Promise.resolve(r.value.content.getOr("")),m=>fetch(m).then(c=>c.ok?c.text():Promise.reject())),l=(r,m)=>(c,h)=>{if(h.name==="template"){const g=c.getData().template;t(r,g).each(u=>{c.block("Loading..."),s(u).then(v=>{m(c,u,v)}).catch(()=>{m(c,u,""),c.setEnabled("save",!1),a(c)})})}},o=r=>m=>{const c=m.getData();t(r,c.template).each(h=>{s(h).then(g=>{n.execCommand("mceInsertTemplate",!1,g),m.close()}).catch(()=>{m.setEnabled("save",!1),a(m)})})};(()=>{if(!e||e.length===0){const r=n.translate("No templates defined.");return n.notificationManager.open({text:r,type:"info"}),i.none()}return i.from(f.map(e,(r,m)=>{const c=h=>h.url!==void 0;return{selected:m===0,text:r.title,value:{url:c(r)?i.from(r.url):i.none(),content:c(r)?i.none():i.from(r.content),description:r.description}}}))})().each(r=>{const m=(u=>((v,y)=>{const S=v.length,w=new Array(S);for(let p=0;p<S;p++){const b=v[p];w[p]={text:(C=b).text,value:C.text}}var C;return w})(u))(r),c=(u,v)=>({title:"Insert Template",size:"large",body:{type:"panel",items:u},initialData:v,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:o(r),onChange:l(r,h)}),h=(u,v,y)=>{const S=((p,b)=>{var A;if(b.indexOf("<html>")===-1){let D="";const Y=(A=V(p))!==null&&A!==void 0?A:"",ae=G(p)?' crossorigin="anonymous"':"";f.each(p.contentCSS,oe=>{D+='<link type="text/css" rel="stylesheet" href="'+p.documentBaseURI.toAbsolute(oe)+'"'+ae+">"}),Y&&(D+='<style type="text/css">'+Y+"</style>");const re=Q(p),I=p.dom.encode,le='<script>document.addEventListener && document.addEventListener("click", function(e) {for (var elm = e.target; elm; elm = elm.parentNode) {if (elm.nodeName === "A" && !('+(j.os.isMacOS()||j.os.isiOS()?"e.metaKey":"e.ctrlKey && !e.altKey")+")) {e.preventDefault();}}}, false);</script> ",J=p.getBody().dir,se=J?' dir="'+I(J)+'"':"";b='<!DOCTYPE html><html><head><base href="'+I(p.documentBaseURI.getURI())+'">'+D+le+'</head><body class="'+I(re)+'"'+se+">"+b+"</body></html>"}return H(b,W(p))})(n,y),w=[{type:"selectbox",name:"template",label:"Templates",items:m},{type:"htmlpanel",html:`<p aria-live="polite">${ee(v.value.description)}</p>`},{label:"Preview",type:"iframe",name:"preview",sandboxed:!1,transparent:!1}],C={template:v.text,preview:S};u.unblock(),u.redial(c(w,C)),u.focus("template")},g=n.windowManager.open(c([],{template:"",preview:""}));g.block("Loading..."),s(r[0]).then(u=>{h(g,r[0],u)}).catch(()=>{h(g,r[0],""),g.setEnabled("save",!1),a(g)})})};B.add("template",n=>{(e=>{const t=e.options.register;t("template_cdate_classes",{processor:"string",default:"cdate"}),t("template_mdate_classes",{processor:"string",default:"mdate"}),t("template_selected_content_classes",{processor:"string",default:"selcontent"}),t("template_preview_replace_values",{processor:"object"}),t("template_replace_values",{processor:"object"}),t("templates",{processor:a=>N(a)||((s,l)=>{if($(s)){for(let o=0,r=s.length;o<r;++o)if(!l(s[o]))return!1;return!0}return!1})(a,F)||M(a),default:[]}),t("template_cdate_format",{processor:"string",default:e.translate("%Y-%m-%d")}),t("template_mdate_format",{processor:"string",default:e.translate("%Y-%m-%d")})})(n),(e=>{const t=()=>e.execCommand("mceTemplate");e.ui.registry.addButton("template",{icon:"template",tooltip:"Insert template",onAction:t}),e.ui.registry.addMenuItem("template",{icon:"template",text:"Insert template...",onAction:t})})(n),(e=>{e.addCommand("mceInsertTemplate",function(t,...a){return(...s)=>{const l=a.concat(s);return t.apply(null,l)}}(te,e)),e.addCommand("mceTemplate",((t,a)=>()=>{const s=q(t);M(s)?s(a):N(s)?fetch(s).then(l=>{l.ok&&l.json().then(a)}):a(s)})(e,(t=>a=>{ne(t,a)})(e)))})(n),(e=>{e.on("PreProcess",t=>{const a=e.dom,s=E(e);f.each(a.select("div",t.node),l=>{a.hasClass(l,"mceTmpl")&&(f.each(a.select("*",l),o=>{x(a,o,k(e))&&(o.innerHTML=T(e,s))}),L(e,l))})})})(n)})})();
