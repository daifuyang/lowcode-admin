var C=Object.assign;(function(){"use strict";var F=tinymce.util.Tools.resolve("tinymce.PluginManager");const O=o=>e=>o===e,N=O(null),P=O(void 0),$=()=>{},I=()=>!1;class l{constructor(e,s){this.tag=e,this.value=s}static some(e){return new l(!0,e)}static none(){return l.singletonNone}fold(e,s){return this.tag?s(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?l.some(e(this.value)):l.none()}bind(e){return this.tag?e(this.value):l.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:l.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(e!=null?e:"Called getOrDie on None")}static from(e){return e==null?l.none():l.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}l.singletonNone=new l(!1);const z=(o,e)=>{const s=o.length,t=new Array(s);for(let n=0;n<s;n++){const r=o[n];t[n]=e(r,n)}return t},_=o=>{let e=o;return{get:()=>e,set:s=>{e=s}}},x=Object.keys,M=Object.hasOwnProperty,L=(o,e)=>{const s=x(o);for(let t=0,n=s.length;t<n;t++){const r=s[t];e(o[r],r)}},T=(o,e)=>M.call(o,e),R=(D=(o,e)=>e,(...o)=>{if(o.length===0)throw new Error("Can't merge zero objects");const e={};for(let s=0;s<o.length;s++){const t=o[s];for(const n in t)T(t,n)&&(e[n]=D(e[n],t[n]))}return e});var D;const E=()=>{const o=(e=>{const s=_(l.none()),t=()=>s.get().each(e);return{clear:()=>{t(),s.set(l.none())},isSet:()=>s.get().isSome(),get:()=>s.get(),set:n=>{t(),s.set(l.some(n))}}})($);return C(C({},o),{on:e=>o.get().each(e)})},S=(o,e,s=0,t)=>{const n=o.indexOf(e,s);return n!==-1&&(!!P(t)||n+e.length<=t)};var U=tinymce.util.Tools.resolve("tinymce.Resource");const y=o=>e=>e.options.get(o),B=y("emoticons_database"),q=y("emoticons_database_url"),G=y("emoticons_database_id"),H=y("emoticons_append"),J=y("emoticons_images_url"),b="All",K={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},Q=(o,e)=>T(o,e)?o[e]:e,V=o=>{const e=H(o);return s=t=>C({keywords:[],category:"user"},t),((t,n)=>{const r={};return L(t,(a,c)=>{const u=n(a,c);r[u.k]=u.v}),r})(e,(t,n)=>({k:n,v:s(t)}));var s},W=(o,e)=>S(o.title.toLowerCase(),e)||((s,t)=>{for(let r=0,a=s.length;r<a;r++)if(n=s[r],S(n.toLowerCase(),e))return!0;var n;return!1})(o.keywords),k=(o,e,s)=>{const t=[],n=e.toLowerCase(),r=s.fold(()=>I,a=>c=>c>=a);for(let a=0;a<o.length&&(e.length!==0&&!W(o[a],n)||(t.push({value:o[a].char,text:o[a].title,icon:o[a].char}),!r(t.length)));a++);return t},w="pattern",X=(o,e)=>{const s={pattern:"",results:k(e.listAll(),"",l.some(300))},t=_(b),n=((g,d)=>{let m=null;const i=()=>{N(m)||(clearTimeout(m),m=null)};return{cancel:i,throttle:(...h)=>{i(),m=setTimeout(()=>{m=null,g.apply(null,h)},200)}}})(g=>{(d=>{const m=d.getData(),i=t.get(),h=e.listCategory(i),p=k(h,m.pattern,i===b?l.some(300):l.none());d.setData({results:p})})(g)}),r={label:"Search",type:"input",name:w},a={type:"collection",name:"results"},c=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:z(e.listCategories(),g=>({title:g,name:g,items:[r,a]}))},initialData:s,onTabChange:(g,d)=>{t.set(d.newTabName),n.throttle(g)},onChange:n.throttle,onAction:(g,d)=>{d.name==="results"&&(((m,i)=>{m.insertContent(i)})(o,d.value),g.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),u=o.windowManager.open(c());u.focus(w),e.hasLoaded()||(u.block("Loading emojis..."),e.waitForLoad().then(()=>{u.redial(c()),n.throttle(u),u.focus(w),u.unblock()}).catch(g=>{u.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),u.focus(w),u.unblock()}))};F.add("emoticons",(o,e)=>{((t,n)=>{const r=t.options.register;r("emoticons_database",{processor:"string",default:"emojis"}),r("emoticons_database_url",{processor:"string",default:`${n}/js/${B(t)}${t.suffix}.js`}),r("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),r("emoticons_append",{processor:"object",default:{}}),r("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})})(o,e);const s=((t,n,r)=>{const a=E(),c=E(),u=J(t),g=i=>{return p="<img",(h=i.char).length>=p.length&&h.substr(0,0+p.length)===p?i.char.replace(/src="([^"]+)"/,(v,j)=>`src="${u}${j}"`):i.char;var h,p};t.on("init",()=>{U.load(r,n).then(i=>{const h=V(t);(p=>{const v={},j=[];L(p,(A,Y)=>{const f={title:Y,keywords:A.keywords,char:g(A),category:Q(K,A.category)},Z=v[f.category]!==void 0?v[f.category]:[];v[f.category]=Z.concat([f]),j.push(f)}),a.set(v),c.set(j)})(R(i,h))},i=>{console.log(`Failed to load emojis: ${i}`),a.set({}),c.set([])})});const d=()=>c.get().getOr([]),m=()=>a.isSet()&&c.isSet();return{listCategories:()=>[b].concat(x(a.get().getOr({}))),hasLoaded:m,waitForLoad:()=>m()?Promise.resolve(!0):new Promise((i,h)=>{let p=15;const v=setInterval(()=>{m()?(clearInterval(v),i(!0)):(p--,p<0&&(console.log("Could not load emojis from url: "+n),clearInterval(v),h(!1)))},100)}),listAll:d,listCategory:i=>i===b?d():a.get().bind(h=>l.from(h[i])).getOr([])}})(o,q(o),G(o));((t,n)=>{t.addCommand("mceEmoticons",()=>X(t,n))})(o,s),(t=>{const n=()=>t.execCommand("mceEmoticons");t.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:n}),t.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:n})})(o),((t,n)=>{t.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(r,a)=>n.waitForLoad().then(()=>{const c=n.listAll();return k(c,r,l.some(a))}),onAction:(r,a,c)=>{t.selection.setRng(a),t.insertContent(c),r.hide()}})})(o,s),(t=>{t.on("PreInit",()=>{t.parser.addAttributeFilter("data-emoticon",n=>{((r,a)=>{for(let u=0,g=r.length;u<g;u++)(c=r[u]).attr("data-mce-resize","false"),c.attr("data-mce-placeholder","1");var c})(n)})})})(o)})})();
