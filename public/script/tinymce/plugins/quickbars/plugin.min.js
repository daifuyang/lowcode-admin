(function(){"use strict";var T=tinymce.util.Tools.resolve("tinymce.PluginManager");const h=n=>t=>typeof t===n,N=n=>(t=>{const o=typeof t;return t===null?"null":o==="object"&&Array.isArray(t)?"array":o==="object"&&(e=i=t,(r=String).prototype.isPrototypeOf(e)||((s=i.constructor)===null||s===void 0?void 0:s.name)===r.name)?"string":o;var e,i,r,s})(n)==="string",b=h("boolean"),v=h("function"),m=n=>t=>t.options.get(n),C=m("quickbars_selection_toolbar"),M=m("quickbars_insert_toolbar"),E=m("quickbars_image_toolbar");let p=0;var S=tinymce.util.Tools.resolve("tinymce.Env"),A=tinymce.util.Tools.resolve("tinymce.util.Delay");const x=n=>{n.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:()=>{(t=>new Promise(o=>{const e=document.createElement("input");e.type="file",e.accept="image/*",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.opacity="0.001",document.body.appendChild(e),e.addEventListener("change",r=>{o(Array.prototype.slice.call(r.target.files))});const i=r=>{const s=()=>{var c;o([]),(c=e.parentNode)===null||c===void 0||c.removeChild(e)};S.os.isAndroid()&&r.type!=="remove"?A.setEditorTimeout(t,s,0):s(),t.off("focusin remove",i)};t.on("focusin remove",i),e.click()}))(n).then(t=>{if(t.length>0){const o=t[0];(e=>new Promise(i=>{const r=new FileReader;r.onloadend=()=>{i(r.result.split(",")[1])},r.readAsDataURL(e)}))(o).then(e=>{((i,r,s)=>{const c=i.editorUpload.blobCache,a=c.create((u=>{const d=new Date().getTime(),g=Math.floor(1e9*Math.random());return p++,"mceu_"+g+p+String(d)})(),s,r);c.add(a),i.insertContent(i.dom.createHTML("img",{src:a.blobUri()}))})(n,e,o)})}})}}),n.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:()=>{((t,o,e)=>{t.execCommand("mceInsertTable",!1,{rows:2,columns:2})})(n)}})},f=()=>!1;class l{constructor(t,o){this.tag=t,this.value=o}static some(t){return new l(!0,t)}static none(){return l.singletonNone}fold(t,o){return this.tag?o(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?l.some(t(this.value)):l.none()}bind(t){return this.tag?t(this.value):l.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:l.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(t!=null?t:"Called getOrDie on None")}static from(t){return t==null?l.none():l.some(t)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}l.singletonNone=new l(!1),typeof window!="undefined"||Function("return this;")();var y=(n,t,o,e,i)=>n(o,e)?l.some(o):v(i)&&i(o)?l.none():t(o,e,i);const O=n=>{if(n==null)throw new Error("Node cannot be null or undefined");return{dom:n}},k=O,w=(n,t)=>{const o=n.dom;if(o.nodeType!==1)return!1;{const e=o;if(e.matches!==void 0)return e.matches(t);if(e.msMatchesSelector!==void 0)return e.msMatchesSelector(t);if(e.webkitMatchesSelector!==void 0)return e.webkitMatchesSelector(t);if(e.mozMatchesSelector!==void 0)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},q=(n,t,o)=>{let e=n.dom;const i=v(o)?o:f;for(;e.parentNode;){e=e.parentNode;const r=k(e);if(t(r))return l.some(r);if(i(r))break}return l.none()},B=(n,t,o)=>q(n,e=>w(e,t),o),D=n=>{const t=M(n);t.length>0&&n.ui.registry.addContextToolbar("quickblock",{predicate:o=>{const e=k(o),i=n.schema.getTextBlockElements(),r=s=>s.dom===n.getBody();return!((s,c)=>{const a=s.dom;return!(!a||!a.hasAttribute)&&a.hasAttribute("data-mce-bogus")})(e)&&((s,c,a)=>y((u,d)=>w(u,d),B,s,'table,[data-mce-bogus="all"]',a))(e,0,r).fold(()=>((s,c,a)=>((u,d,g)=>y((I,P)=>P(I),q,u,d,g))(s,c,a).isSome())(e,s=>s.dom.nodeName.toLowerCase()in i&&n.dom.isEmpty(s.dom),r),f)},items:t,position:"line",scope:"editor"})};T.add("quickbars",n=>{(t=>{const o=t.options.register,e=c=>a=>{const u=b(a)||N(a);return u?b(a)?{value:a?c:"",valid:u}:{value:a.trim(),valid:u}:{valid:!1,message:"Must be a boolean or string."}},i="bold italic | quicklink h2 h3 blockquote";o("quickbars_selection_toolbar",{processor:e(i),default:i});const r="quickimage quicktable";o("quickbars_insert_toolbar",{processor:e(r),default:r});const s="alignleft aligncenter alignright";o("quickbars_image_toolbar",{processor:e(s),default:s})})(n),x(n),D(n),(t=>{const o=r=>r.nodeName==="IMG"||r.nodeName==="FIGURE"&&/image/i.test(r.className),e=E(t);e.length>0&&t.ui.registry.addContextToolbar("imageselection",{predicate:o,items:e,position:"node"});const i=C(t);i.length>0&&t.ui.registry.addContextToolbar("textselection",{predicate:r=>!o(r)&&!t.selection.isCollapsed()&&(s=>t.dom.getContentEditableParent(s)!=="false")(r),items:i,position:"selection",scope:"editor"})})(n)})})();
